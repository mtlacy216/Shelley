<!DOCTYPE html>
<html>
<head>
    <title>Camera Access</title>
    <style>
        #videoContainer {
            text-align: center; /* Center the video and button */
        }
        #camera {
            width: 80%; /* Adjust as needed */
            height: auto;
        }
        #capture {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>

    <div id="videoContainer">
        <video id="camera" autoplay></video>
        <button id="capture">Capture</button>
    </div>
    <button id="fullscreen">Fullscreen</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="photo" src="">

    <script>
        let videoContainer = document.getElementById('videoContainer');
        let video = document.getElementById('camera');
        let canvas = document.getElementById('canvas');
        let photo = document.getElementById('photo');
        let captureButton = document.getElementById('capture');
        let fullscreenButton = document.getElementById('fullscreen');

        // Get access to the camera
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function(err) {
                    console.log("An error occurred: " + err);
                });
        }

        // Capture the photo
        captureButton.addEventListener('click', function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            let imageData = canvas.toDataURL('image/png').split(',')[1];
            photo.setAttribute('src', 'data:image/png;base64,' + imageData);

            sendImageToWebhook(imageData);
        });

        // Fullscreen functionality
        fullscreenButton.addEventListener('click', function() {
            if (videoContainer.requestFullscreen) {
                videoContainer.requestFullscreen();
            } else if (videoContainer.mozRequestFullScreen) {
                videoContainer.mozRequestFullScreen();
            } else if (videoContainer.webkitRequestFullscreen) {
                videoContainer.webkitRequestFullscreen();
            } else if (videoContainer.msRequestFullscreen) {
                videoContainer.msRequestFullscreen();
            }
        });

        // Function to convert base64 image to blob and send it to the webhook using FormData
        function sendImageToWebhook(base64Data) {
            let byteString = atob(base64Data);
            let arrayBuffer = new ArrayBuffer(byteString.length);
            let uint8Array = new Uint8Array(arrayBuffer);
            for (let i = 0; i < byteString.length; i++) {
                uint8Array[i] = byteString.charCodeAt(i);
            }
            let blob = new Blob([uint8Array], {type: 'image/png'});
            
            let formData = new FormData();
            formData.append('file', blob, 'image.png');

            fetch('https://hooks.zapier.com/hooks/catch/6501299/303vhv0/', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                console.log('Webhook response:', data);
            })
            .catch((error) => {
                console.error('Error sending to webhook:', error);
            });
        }
    </script>

</body>
</html>
