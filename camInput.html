<!DOCTYPE html>
<html>
<head>
    <title>Camera Access</title>
    <style>
        #camera {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

    <video id="camera" autoplay></video>
    <button id="capture">Capture</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="photo" src="">

    <script>
        let video = document.getElementById('camera');
        let canvas = document.getElementById('canvas');
        let photo = document.getElementById('photo');
        let captureButton = document.getElementById('capture');

        // Get access to the camera
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function(err) {
                    console.log("An error occurred: " + err);
                });
        }

        // Capture the photo and send it to the webhook
        captureButton.addEventListener('click', function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            let imageData = canvas.toDataURL('image/png').split(',')[1]; // Get the base64 part
            photo.setAttribute('src', 'data:image/png;base64,' + imageData);

            sendImageToWebhook(imageData);
        });

        // Function to convert base64 image to blob and send it to the webhook using FormData
        function sendImageToWebhook(base64Data) {
            // Convert base64 to raw binary data held in a string
            let byteString = atob(base64Data);
            // Write the bytes of the string to an ArrayBuffer
            let arrayBuffer = new ArrayBuffer(byteString.length);
            let uint8Array = new Uint8Array(arrayBuffer);
            for (let i = 0; i < byteString.length; i++) {
                uint8Array[i] = byteString.charCodeAt(i);
            }
            // Create a blob from the ArrayBuffer
            let blob = new Blob([uint8Array], {type: 'image/png'});
            
            let formData = new FormData();
            formData.append('file', blob, 'image.png');

            fetch('https://hooks.zapier.com/hooks/catch/6501299/303vhv0/', {
                method: 'POST',
                body: formData // Note: No need to set Content-Type header, as it will be set automatically by the browser when sending FormData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                console.log('Webhook response:', data);
            })
            .catch((error) => {
                console.error('Error sending to webhook:', error);
            });
        }
    </script>

</body>
</html>
